<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="file-inputs">
      <div>
        <label for="file1">Main Dataset</label>
        <input type="file" name="file1" id="file1" />
        <label for="file1">Description Index</label>
        <input type="number" min="0" name="index1" id="index1" />
      </div>
    </div>
    <div>
      <button onclick="submitForm()">Submit</button>
    </div>

    <button id="add-dataset">Add Dataset</button>
  </body>

  <script>
    let fileindex = 1;

    async function submitForm(event) {
      const formData = new FormData();

      console.log("List fields here");

      const inputs = document.querySelector("#file-inputs");
      const fileInputs = inputs.querySelectorAll("input[type='file']");
      const indexInputs = inputs.querySelectorAll("input[type='number']");

      fileInputs.forEach((input) => {
        let fileInput = document.querySelector(`input#${input.id}`);
        formData.append("files", fileInput.files[0]);
      });
      indexInputs.forEach((input) => {
        let indexInput = document.querySelector(`input#${input.id}`);
        formData.append("indices", indexInput.value);
      });
      try {
        fetch("/results", {
          method: "POST",
          body: formData,
        });
      } catch (error) {
        console.log(error);
      }
    }

    function addDataset() {
      fileindex += 1;

      const inputs = document.querySelector("#file-inputs");

      const newDiv = document.createElement("div");
      const fileLabel = document.createElement("label");
      const fileInput = document.createElement("input");

      const indexLabel = document.createElement("label");
      const indexInput = document.createElement("input");

      fileLabel.setAttribute("for", "file" + fileindex);
      fileLabel.innerText = "Dataset " + fileindex;

      fileInput.setAttribute("type", "file");
      fileInput.setAttribute("name", "file" + fileindex);
      fileInput.setAttribute("id", "file" + fileindex);

      indexLabel.setAttribute("for", "index" + fileindex);
      indexLabel.innerText = "Description Index";

      indexInput.setAttribute("type", "number");
      indexInput.setAttribute("min", "0");
      indexInput.setAttribute("name", "index" + fileindex);
      indexInput.setAttribute("id", "index" + fileindex);

      newDiv.appendChild(fileLabel);
      newDiv.appendChild(fileInput);
      newDiv.appendChild(indexLabel);
      newDiv.appendChild(indexInput);

      inputs.insertAdjacentElement("beforeend", newDiv);
    }

    document
      .querySelector("#add-dataset")
      .addEventListener("click", addDataset);
  </script>
</html>
